@using System.Collections
@using KanbanTracker.Classes
@using KanbanTracker.Models
@using MongoDB.Bson
@using MongoDB.Driver
@model KanbanTracker.Models.StoryViewModel

@functions {
    public MongoCollection<User> Open;
    public MongoCollection<Project> ProjectOpen;
}

@{
    Open = UserDb.Open();
    ProjectOpen = ProjectDb.Open();
    var individualProject = (Project) ProjectOpen.FindOneById(ObjectId.Parse(@ViewBag.id));
    var story = individualProject.Stories.Find(s => s.Id == @ViewBag.storyId);   
}

<div id="body">
    <section class="featured">
        <div class="content-wrapper">
            <hgroup class="title">
                <h1>Edit story</h1>
            </hgroup>
            @using (Html.BeginForm("Story_Edit", "Projects", FormMethod.Post, new { @class = "form-horizontal", role = "form" }))
            {
                @Html.AntiForgeryToken()
                @Html.ValidationSummary("", new { @class = "text-danger" })

                <div class="form-group">
                    <div class="col-md-10">
                        <input class="form-control" data-val="true" data-val-required="The Title field is required." id="Title" name="Title" value="@story.Title"/>
                    </div>
                </div>
                
                <div class="form-group">
                    <div class="col-md-10">
                        <input class="form-control" data-val="true" data-val-required="The Description field is required." id="Description" name="Description" value="@story.Description"/>
                    </div>
                </div>
                
                <div class="form-group">
                    <div class="col-md-10">
                        <input class="form-control" data-val="true" data-val-required="The Title field is required." id="Id" name="Id" value="@story.Id" type="hidden"/>
                        <input class="form-control" data-val="true" data-val-required="The Title field is required." id="ProjectId" name="ProjectId" value="@individualProject.Id" type="hidden"/> 
                    </div>
                </div>
                
                <div class="form-group">
                    @Html.LabelFor(m => m.Assigned, new { @class = "col-md-2 control-label" })
                    <div class="col-md-10">
                        <select>
                            @foreach (var user in Open.FindAll())
                            {
                                <option value="@user.Id">@user.UserName</option>
                            }
                        </select>
                    </div>
                </div>
        
                <div class="form-group">
                    <label class="col-md-2 control-label" for="Status">Status</label>
                    <div class="col-md-10">
                        <select id="Status" name="Status">
                            <option value="backlog">Backlog</option>
                            <option value="readytogo">Ready to go</option>
                            <option value="development">Development</option>
                            <option value="codereview">Code Review</option>
                            <option value="testing">Testing</option>
                            <option value="complete">Complete</option>
                            <option value="accepted">Accepted</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <div class="col-md-offset-2 col-md-10">
                        <input type="submit" class="btn btn-default" value="Update story" />
                    </div>
                </div>
                
                
            }<a href="/projects/story_delete/@individualProject.Id?storyId=@story.Id">Delete Story</a></div>

    </section>
    
</div>

